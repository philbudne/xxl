// -*-js-*-
// define "do" statement
var p = __modinfo.parser;	// Parser object

var Do = Class.new({
    name: "Do",
    supers: [p.Stmt],
    methods: {
	std: function (this) {	// parse as statement
	    this.first = p.block();
	    p.advance("while");
	    p.advance("(");
	    this.second = p.expression(0);
	    p.advance(")");
	    p.expect(";", true);
	    this.arity = "statement";
	    return(this);
	},
	gen: function (this, vmcode) { // gen
	    var top_label = vmcode.get_off();
	    this.first.gen(vmcode);  // block
	    this.second.gen(vmcode); // condition
	    vmcode.emit_iftrue(top_label, this);
	}
    }
});
p.add_symbol_class("do", Do);

//////////////// tests

var i = 4;
do {
    __xxl.print(i);
    i -= 1;
} while (i > 0);

__xxl.print("continue test");
i = 4;
do continue: {
    __xxl.print(i);
    i -= 1;
    continue();
    __xxl.print("here");
} while (i > 0);

__xxl.print("break test");
i = 4;
break:
do {
    __xxl.print(i);
    i -= 1;
    break();
} while (i > 0);
